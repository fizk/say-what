<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/app-route/app-route.html">
<link rel="import" href="../../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../../bower_components/app-route/app-location.html">
<link rel="import" href="../../../bower_components/polymerfire/firebase-query.html">

<link rel="import" href="../app-container/app-container.html">
<link rel="import" href="../index-container/index-container.html">
<link rel="import" href="../articles-container/articles-container.html">
<link rel="import" href="../about-container/about-container.html">

<dom-module id="app-container">
    <script src="https://cdn.firebase.com/js/client/2.4.2/firebase.js"></script>
    <template>
        <app-route
                route="{{route}}"
                pattern="/:page"
                data="{{routeData}}"
                tail="{{subRoute}}">
        </app-route>

        <!--<firebase-query-->
                <!--order-by-child="date/from"-->
                <!--path="/work"-->
                <!--data="{{articles}}">-->
        <!--</firebase-query>-->



        <iron-pages selected="[[routeData.page]]" attr-for-selected="key">
            <index-container key="" articles="[[articles]]"></index-container>
            <articles-container key="articles" route="{{subRoute}}" articles="[[articles]]" user="[[user]]" database="{{firebase}}"></articles-container>
            <about-container key="about"></about-container>
        </iron-pages>
    </template>
    <script>
        Polymer({
            is: 'app-container',

            properties: {
                articles: {
                    type: Array
                },

                firebase: {
                    type: Object
                }
            },
            
            ready: function () {
                this.firebase = new Firebase('https://klingogbang.firebaseio.com');

                this.firebase.on('child_changed', function (snapshot) {
                    var changedPost = snapshot.val();
                    console.log("The updated post title is ", changedPost);
                });

                this.firebase.child("/work").on("value", function(snapshot) {
                    var articles = [];
                    var data = snapshot.val();
                    for (article in data) {
                        data[article].$key = article;
                        articles.push(data[article]);
                    }

                    this.articles = articles.sort(function (a, b) {
                        return new Date(b.date.from) - new Date(a.date.from)
                    });

                }.bind(this));


            }
        });
    </script>
</dom-module>
