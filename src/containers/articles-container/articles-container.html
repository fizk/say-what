<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/app-route/app-route.html">
<link rel="import" href="../../../bower_components/iron-pages/iron-pages.html">

<link rel="import" href="../../pages/articles-article/articles-article.html">
<link rel="import" href="../../pages/articles-list/articles-list.html">
<link rel="import" href="../../pages/articles-edit/articles-edit.html">
<link rel="import" href="../../pages/articles-create/articles-create.html">

<dom-module id="articles-container">
    <template>

        <app-route
                route="{{route}}"
                path="/">
        </app-route>
        <app-route
                route="{{route}}"
                path="/:slug"
                data="{{slugData}}">
        </app-route>
        <app-route
                route="{{route}}"
                path="/:slug/edit"
                data="{{slugData}}">
        </app-route>

        <iron-pages selected="[[pageSelected]]" attr-for-selected="key">
            <articles-list key="" articles="{{articles}}" user="[[user]]"></articles-list>
            <articles-article key="selected" articles="{{articles}}" slug="[[slug]]" user="[[user]]"></articles-article>
            <articles-edit key="edit" slug="[[slug]]" articles="[[articles]]"></articles-edit>
            <articles-create key="create"></articles-create>
        </iron-pages>

    </template>
    <script>
        Polymer({
            is: 'articles-container',

            observers: [
                '_observerRoutePath(route.path)'
            ],

            properties: {
                pageSelected: {
                    type: String,
                    value: ''
                },
                slug: {
                    type: String
                },

                user: {
                    type: Object
                }
            },

            /**
             *
             * @param path
             * @private
             * @todo this is terrible...
             */
            _observerRoutePath: function (path) {
                console.log(this.user);
                if (!path) {
                    this.slug = undefined;
                    this.pageSelected = '';
                } else if (path.match(/^\/create$/)) {
                    this.slug = undefined;
                    this.pageSelected = 'create';
                } else if (path.match(/^\/[0-9a-zA-Z\-]+$/)) {
                    this.pageSelected = 'selected';
                    this.slug = path.substring(1);
                } else if (path.match(/^\/[0-9a-zA-Z\-]+\/edit$/)) {
                    this.pageSelected = 'edit';
                    this.slug = path.match(/(\/)([0-9a-zA-Z\-]+)(\/edit)$/)[2];
                } else {
                    this.slug = undefined;
                    this.pageSelected = '';
                }
            }
        })
    </script>
</dom-module>
